# 📁 Email Template Storage in GCP

## 🗄️ **Where Templates Are Saved**

### **1. Firestore Database (Primary Storage)**
Your email templates are stored in **Google Cloud Firestore** under the project `salon-database-464315`.

#### **Database Structure:**
```
📁 Firestore Database: salon-database-464315
├── 📁 organizations/
│   └── 📄 [organizationId]/
│       ├── name: "Salon Name"
│       ├── industry: "salon"
│       ├── settings: {
│       │   ├── branding: { logo, colors, fonts }
│       │   ├── aiConfig: { prompts, placeholders }
│       │   └── subscription: { plan, limits }
│       │ }
│       ├── members: { [userId]: "admin" }
│       ├── createdAt: timestamp
│       └── updatedAt: timestamp
│
├── 📁 templates/
│   └── 📄 [templateId]/
│       ├── organizationId: "org_123"
│       ├── userId: "user_456"
│       ├── name: "Welcome Email"
│       ├── subject: "Welcome to Our Salon"
│       ├── contentHtml: "<html>...</html>"
│       ├── contentText: "Welcome text..."
│       ├── placeholders: ["{salon_name}", "{client_name}"]
│       ├── category: "welcome"
│       ├── isPublic: false
│       ├── createdAt: timestamp
│       └── updatedAt: timestamp
│
└── 📁 users/
    └── 📄 [userId]/
        ├── email: "user@example.com"
        ├── name: "User Name"
        ├── organizationId: "org_123"
        ├── role: "admin"
        └── createdAt: timestamp
```

### **2. Cloud Storage (File Assets)**
Images and files are stored in **Google Cloud Storage**:

```
📁 Cloud Storage: salon-database-464315.appspot.com
├── 📁 organizations/
│   └── 📁 [organizationId]/
│       ├── 📁 templates/
│       │   └── 📁 [templateId]/
│       │       ├── 🖼️ images/
│       │       │   ├── image-1.jpg
│       │       │   └── image-2.png
│       │       └── 📄 assets/
│       │           └── logo.png
│       └── 📁 branding/
│           ├── 🖼️ logos/
│           │   └── salon-logo.png
│           └── 🎨 assets/
│               └── brand-colors.json
│
└── 📁 public/
    └── 📁 templates/
        └── 📁 [templateId]/
            └── 🖼️ shared-assets/
                └── public-image.jpg
```

## 🔧 **How to Access Your Templates**

### **1. Firebase Console (Web Interface)**
- **URL**: https://console.firebase.google.com/project/salon-database-464315
- **Navigate to**: Firestore Database → Data
- **View templates**: `templates` collection
- **View organizations**: `organizations` collection

### **2. Cloud Storage Console**
- **URL**: https://console.cloud.google.com/storage/browser?project=salon-database-464315
- **Navigate to**: Your bucket → organizations → [orgId] → templates

### **3. Programmatic Access**
```typescript
// Get all templates for an organization
this.templateService.getTemplates().subscribe(templates => {
  console.log('Templates:', templates);
});

// Save a new template
this.templateService.saveTemplate(templateData).subscribe(templateId => {
  console.log('Template saved with ID:', templateId);
});

// Load a specific template
this.templateService.getTemplate(templateId).subscribe(template => {
  console.log('Template loaded:', template);
});
```

## 📊 **Template Data Structure**

### **Template Object:**
```typescript
interface EmailTemplate {
  id?: string;                    // Auto-generated by Firestore
  organizationId: string;         // Links to organization
  userId: string;                 // Creator's user ID
  name: string;                   // Template name
  subject: string;                // Email subject
  contentHtml: string;            // Full HTML content
  contentText: string;            // Plain text version
  placeholders: string[];         // Extracted placeholders
  category: string;               // Template category
  isPublic: boolean;              // Public/private flag
  createdAt?: Date;               // Creation timestamp
  updatedAt?: Date;               // Last update timestamp
}
```

### **Organization Object:**
```typescript
interface Organization {
  id?: string;                    // Auto-generated by Firestore
  name: string;                   // Organization name
  industry: string;               // Business type
  settings: {
    branding: {
      logo: string;               // Logo URL
      colors: string[];           // Brand colors
      fonts: string[];            // Font families
    };
    aiConfig: {
      prompts: string;            // AI prompt templates
      placeholders: string[];     // Available placeholders
    };
    subscription: {
      plan: string;               // Subscription tier
      limits: {
        maxTemplates: number;     // Template limit
        maxUsers: number;         // User limit
        aiCredits: number;        // AI usage limit
      };
    };
  };
  members: { [userId: string]: string }; // User roles
  createdAt?: Date;
  updatedAt?: Date;
}
```

## 🔒 **Security & Access Control**

### **Firestore Security Rules:**
```javascript
rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {
    // Organizations - only members can access
    match /organizations/{orgId} {
      allow read, write: if request.auth != null && 
        (request.auth.token.role == 'admin' || 
         resource.data.members[request.auth.uid] != null);
    }
    
    // Templates - organization members or public
    match /templates/{templateId} {
      allow read, write: if request.auth != null && 
        (resource.data.organizationId == request.auth.token.organizationId ||
         resource.data.isPublic == true);
    }
  }
}
```

### **Storage Security Rules:**
```javascript
rules_version = '2';
service firebase.storage {
  match /b/{bucket}/o {
    // Organization files - only members can access
    match /organizations/{orgId}/{allPaths=**} {
      allow read, write: if request.auth != null && 
        request.auth.token.organizationId == orgId;
    }
    
    // Public assets - anyone can read
    match /public/{allPaths=**} {
      allow read: if true;
      allow write: if request.auth != null;
    }
  }
}
```

## 🚀 **How to Use the Save Functionality**

### **1. Save a Template:**
1. Create your email template in the composer
2. Fill in the template name and subject
3. Click "Save to GCP" button
4. Template is saved to Firestore with auto-generated ID
5. Success message shows the template ID

### **2. Load Templates:**
1. Click "Load Templates" button
2. View saved templates in browser console
3. Use template IDs to load specific templates

### **3. View in Firebase Console:**
1. Go to Firebase Console
2. Navigate to Firestore Database
3. Click on "templates" collection
4. See all your saved templates with full data

## 📈 **Storage Limits & Costs**

### **Firestore Limits:**
- **Free Tier**: 1GB storage, 50K reads, 20K writes per day
- **Paid Tier**: $0.18 per GB, $0.06 per 100K reads, $0.18 per 100K writes

### **Cloud Storage Limits:**
- **Free Tier**: 5GB storage, 1GB download per month
- **Paid Tier**: $0.020 per GB storage, $0.12 per GB download

### **Estimated Costs for 1000 Templates:**
- **Storage**: ~$0.50/month
- **Operations**: ~$2.00/month
- **Total**: ~$2.50/month

## 🔍 **Troubleshooting**

### **Common Issues:**
1. **"No organization selected"** - Set up organization first
2. **"Permission denied"** - Check Firestore security rules
3. **"Template not found"** - Verify template ID exists
4. **"Storage quota exceeded"** - Upgrade Firebase plan

### **Debug Steps:**
1. Check Firebase Console for errors
2. Verify Firestore rules are deployed
3. Check browser console for error messages
4. Ensure user is authenticated

## 🎯 **Next Steps**

1. **Set up Firebase project** (run `./setup-firebase.sh`)
2. **Enable Firestore** in Firebase Console
3. **Deploy security rules** (`firebase deploy --only firestore:rules`)
4. **Test save functionality** in your app
5. **View templates** in Firebase Console

Your email templates are now safely stored in Google Cloud Platform with full backup, security, and scalability! 🚀




